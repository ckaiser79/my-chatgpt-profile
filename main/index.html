<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your yearly ChaetGPT profile</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/print.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/polyglot.js/0.4.2/polyglot.min.js"
        integrity="sha512-SXa0RggkqBgtv9e1Wy49C6agde9NAXf7t/Vz7pE9wgOOuNhOyhwn/a0rdHRZalIvLhxMYkG0FRHfsXDUJOVH2A=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="js/polyglot-init.js" defer></script>


    <!--
    Script loading order (all with defer for non-blocking execution):
    1. js/alpine-include.js: Registers the x-include directive before Alpine initializes.
    2. wordcloud2.js: Defines window.WordCloud for word cloud rendering.
    3. js/index.js: Defines window.myApp with Alpine.js data and methods.
    4. Alpine.js: Initializes x-data="myApp" and runs x-init="load()".
    Defer ensures scripts load in parallel but execute in this order after DOM parsing,
    preventing race conditions and "undefined" errors.
    -->
    <!-- wordcloud2 is lazy-loaded when Beta is enabled via myApp listener -->
    <script src="js/index.js" defer></script>
    <script src="js/alpine-include.js" defer></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>

<body x-data="myApp" x-init="load()">
    
    <header x-include="'partials/header.html'"></header>

    <!-- Toggle + JSON input form: paste custom JSON and apply it to the page (collapsed by default) -->
    <section class="container mb-4" id="custom-json-input">
        <div class="d-flex justify-content-between">
            <div x-include="'partials/howto-chat.html'"></div>
            <div class="d-flex align-items-center">
                <button type="button" class="btn btn-sm btn-light lang-flag mr-1" data-lang="de"
                data-i18n-attr="aria-label=lang.de">ðŸ‡©ðŸ‡ª</button>
                <button type="button" class="btn btn-sm btn-light lang-flag" data-lang="en"
                data-i18n-attr="aria-label=lang.en">ðŸ‡¬ðŸ‡§</button>
                <div class="d-flex align-items-center">
                </div>
            </div>
        </div>

    </section>

    <div x-include="'partials/show-json-dialog.html'"></div>

    <main class="container">

        <!-- My personal AI Usage Profile -->
        <section id="usage-profile" class="card mb-3">
            <div class="card-body text-center">
                <h2 class="card-title mb-1">
                    <span class="display-4" x-text="data.archetype.name">
                        Archetype Headline
                    </span>
                </h2>
            </div>
            <div class="card-body">
                <p class="lead text-muted mb-2" x-text="data.archetype.summary">
                    Personal description of the archetype goes here.
                </p>
            </div>
        </section>

        <section id="interaction-types" class="card mb-3 beta-feature">
            <div class="card-body">
                <h2 class="card-title" data-i18n="home.usedFor">You used the AI for...</h2>
                <div id="wordcloud" style="width: 100%; height: 400px; border: 1px solid #ccc;"></div>
            </div>
        </section>

        <section id="user-level" class="card mb-3">
            <div class="card-body">
                <h2 class="card-title text-center" data-i18n="home.experience">Your experience level</h2>

                <!-- visual 10-block scale (left = interested, right = guru) -->
                <div class="user-level-scale my-3">
                    <div class="d-flex align-items-center user-level-row">
                        <template x-for="(__, index) in 10" :key="index">
                            <button type="button" class="p-0 border-0 user-level-block"
                                :aria-pressed="(index+1) <= (data.userLevel?.value ?? 8) ? 'true' : 'false'"
                                @click="data.userLevel = data.userLevel || {}; data.userLevel.value = index+1"
                                :title="(index+1) + '/10'" :style="(() => {
                          const i = index + 1;
                          const lightness = Math.round(96 - (i - 1) * 7); // ~96 -> ~31
                          const bg = `hsl(140,60%,${lightness}%)`;
                          return `background:${bg};`;
                        })()"></button>
                        </template>
                    </div>

                    <!-- red dot pointer placed over scale based on userLevel.value -->
                    <div class="user-level-pointer" x-cloak :style="{
                      left: (((data.userLevel.value ?? 1) - 1) / 9 * 100) + '%'
                    }" aria-hidden="true"></div>
                </div>

                <div class="d-flex justify-content-between mt-2 small text-muted scale-labels">
                    <span data-i18n="home.scale.beginner">Interested user</span>
                    <span class="mx-auto" data-i18n="home.scale.senior">Senior / Experienced</span>
                    <span class="text-right" data-i18n="home.scale.guru">Guru</span>
                </div>

                <p x-text="data.userLevel?.reason ?? 'A 8 is defined by precise prompts, know capabilities and limits of AI, regular punctual usage.'"
                    class="mt-3">A 8 is defined by precise prompts, know capabilities and limits of ai, regular punktual
                    uasage.</p>
            </div>
        </section>

        <section id="tips-level-up" class="card mb-5">
            <div class="card-body">
                <h2 class="card-title" data-i18n="home.tips">Tips how I can increase my user level</h2>
                <div class="d-flex flex-wrap" style="gap: 1rem;">
                    <template x-if="groupedTips && groupedTips.length">
                        <template x-for="(group, i) in groupedTips" :key="i">
                            <div class="card" style="min-width: 240px; max-width: 320px; flex: 1 1 240px;">
                                <div class="card-body">
                                    <h5 class="card-title" x-text="group.category">Category</h5>
                                    <ul class="mb-0 pl-3">
                                        <template x-for="(tip, j) in group.items" :key="j">
                                            <li x-text="tip">Tip text</li>
                                        </template>
                                    </ul>
                                </div>
                            </div>
                        </template>
                    </template>
                    <template x-if="!groupedTips || !groupedTips.length">
                        <p class="text-muted mb-0" data-i18n="home.noTips">No tips available.</p>
                    </template>
                </div>
            </div>
        </section>
    </main>

    <footer x-include="'partials/footer.html'"></footer>

    <!-- keep lightweight: no jQuery required; bootstrap JS omitted (only CSS used) -->
    <script>
        // Beta feature toggle with cookie persistence
        function setCookie(name, value, days) {
            const d = new Date();
            d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = "expires=" + d.toUTCString();
            document.cookie = name + "=" + encodeURIComponent(value) + ";" + expires + ";path=/";
        }

        function getCookie(name) {
            const cname = name + "=";
            const decodedCookie = decodeURIComponent(document.cookie || "");
            const ca = decodedCookie.split(';');
            for (let c of ca) {
                while (c.charAt(0) === ' ') c = c.substring(1);
                if (c.indexOf(cname) === 0) return c.substring(cname.length, c.length);
            }
            return "";
        }

        function applyBetaState(isBeta) {
            document.body.classList.toggle('beta-on', !!isBeta);
            const sw = document.getElementById('betaSwitch');
            if (sw) sw.checked = !!isBeta;
        }

        document.addEventListener('DOMContentLoaded', function () {
            const isBeta = getCookie('feature_level') === 'BETA';
            applyBetaState(isBeta);
            try { if (window.myApp && window.myApp.onBetaToggle && isBeta) window.myApp.onBetaToggle(true); } catch (_) { }
            const sw = document.getElementById('betaSwitch');
            if (sw) {
                sw.addEventListener('change', function (e) {
                    const checked = !!e.target.checked;
                    setCookie('feature_level', checked ? 'BETA' : 'PROD', 365);
                    applyBetaState(checked);
                    try { if (window.myApp && window.myApp.onBetaToggle) window.myApp.onBetaToggle(checked); } catch (_) { }
                });
            }


        });
    </script>
</body>

</html>