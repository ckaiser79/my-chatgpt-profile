<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/print.css">
    <script src="https://cdn.jsdelivr.net/npm/node-polyglot@2.5.0/build/polyglot.min.js"></script>
    <script src="js/polyglot-init.js"></script>

    <script src="js/alpine-include.js" defer></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

</head>

<body x-data="{}">

    <header x-include="'partials/header.html'"></header>

    <div class="container mb-4 d-flex justify-content-between">
        <div x-include="'partials/howto-chat.html'"></div>
        <div class="d-flex align-items-center">
            <a href="index.html" class="text-primary mr-2" data-i18n="nav.backToProfile">Back to Profile</a>
            <div x-include="'partials/language-switcher.html'"></div>
        </div>
    </div>

    <main class="container">

        <section id="prompt-examples" class="card mb-3">
            <div class="card-body text-center">
                <h2 class="card-title mb-1">
                    <span class="display-4" data-i18n="prompts.heading">
                        Prompt for your GPT user profile
                    </span>
                </h2>
            </div>

            <div class="mt-4">
                <h3 data-i18n="prompts.howTo">How to use this prompt</h3>
                <ol>
                    <li><strong data-i18n="prompts.step1">Copy the prompt below using the "Copy Prompt" button.</strong></li>
                    <li><strong><a href="https://chat.openai.com/" target="_blank" rel="noreferrer" data-i18n="prompts.step2">Open ChatGPT and start a new conversation.</a></strong></li>
                    <li><strong data-i18n="prompts.step3">Paste the prompt into the chat.</strong></li>
                    <li><strong data-i18n="prompts.step4">Copy the JSON output from ChatGPT's response in this page.</strong></li>
                </ol>
            </div>

            <div class="card-body">
                <div class="d-flex justify-content-end mb-2">
                    <button id="copy-btn" class="btn btn-sm btn-outline-secondary"
                        onclick="copyToClipboard('prompt-1', this)" data-i18n="prompts.copyButton">Copy Prompt</button>
                </div>
                <pre class="prompt-code mb-2 p-3 bg-light rounded border" id="prompt-1" data-i18n="prompts.loading">Loading prompt...</pre>
            </div>
        </section>
    </main>

    <footer x-include="'partials/footer.html'"></footer>

    <script>
        // Beta feature toggle with cookie persistence
        function setCookie(name, value, days) {
            const d = new Date();
            d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = "expires=" + d.toUTCString();
            document.cookie = name + "=" + encodeURIComponent(value) + ";" + expires + ";path=/";
        }

        function getCookie(name) {
            const cname = name + "=";
            const decodedCookie = decodeURIComponent(document.cookie || "");
            const ca = decodedCookie.split(';');
            for (let c of ca) {
                while (c.charAt(0) === ' ') c = c.substring(1);
                if (c.indexOf(cname) === 0) return c.substring(cname.length, c.length);
            }
            return "";
        }

        function applyBetaState(isBeta) {
            document.body.classList.toggle('beta-on', !!isBeta);
            const sw = document.getElementById('betaSwitch');
            if (sw) sw.checked = !!isBeta;
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Load prompt from file
            fetch('data/default-prompt.txt')
                .then(r => r.text())
                .then(text => {
                    const promptEl = document.getElementById('prompt-1');
                    if (promptEl) {
                        promptEl.textContent = text;
                    }
                })
                .catch(err => {
                    console.error('Failed to load prompt:', err);
                    document.getElementById('prompt-1').textContent = Polyglot.t('prompts.error');
                });

            // Beta feature toggle with cookie persistence
            const isBeta = getCookie('feature_level') === 'BETA';
            applyBetaState(isBeta);
            const sw = document.getElementById('betaSwitch');
            if (sw) {
                sw.addEventListener('change', function (e) {
                    const checked = !!e.target.checked;
                    setCookie('feature_level', checked ? 'BETA' : 'PROD', 365);
                    applyBetaState(checked);
                });
            }
        });

        function copyToClipboard(elementId, button) {
            const element = document.getElementById(elementId);
            const text = element.textContent || element.innerText;
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = 'Copied to Clipboard';
                setTimeout(() => {
                    button.textContent = 'Copy Prompt';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    button.textContent = 'Copied to Clipboard';
                    setTimeout(() => {
                        button.textContent = 'Copy Prompt';
                    }, 2000);
                } catch (fallbackErr) {
                    console.error('Fallback copy failed: ', fallbackErr);
                    button.textContent = 'Copy Failed';
                    setTimeout(() => {
                        button.textContent = 'Copy Prompt';
                    }, 2000);
                }
                document.body.removeChild(textArea);
            });
        }
    </script>
</body>

</html>